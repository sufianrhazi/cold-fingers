(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();var Te=class extends Error{constructor(e,t){super(e),this.detail=t}};function V(...e){console.warn(...e)}function ee(...e){console.error(...e)}function H(e,...t){throw ee("Invariant error",e,...t),new Te(`Invariant error: ${e}`,t)}function f(e,t,...i){if(!e)throw ee("Assertion failure",e===void 0?"undefined":e===null?"null":e.toString(),"is not truthy",t,...i),new Te(`Assertion failure: ${t}`,i)}function F(e,...t){throw ee("Assertion failure",e,"is not exhausted",...t),new Te("Assertion failure",{context:e,items:t})}function Oe(e){return!!(e&&typeof e=="object"&&"__renderNode"in e&&typeof e.__renderNode=="function")}function lt(e){if(e)return""}function C(e){if(e!==void 0)return typeof e=="number"?e:parseInt(e)}function ct(e){if(e!==void 0)return e!=="no"}var dt={"accept-charset":{idn:"acceptCharset"},"aria-atomic":{idn:"ariaAtomic"},"aria-autocomplete":{idn:"ariaAutoComplete"},"aria-busy":{idn:"ariaBusy"},"aria-checked":{idn:"ariaChecked"},"aria-colcount":{idn:"ariaColCount"},"aria-colindex":{idn:"ariaColIndex"},"aria-colindextext":{idn:"ariaColIndexText"},"aria-colspan":{idn:"ariaColSpan"},"aria-current":{idn:"ariaCurrent"},"aria-disabled":{idn:"ariaDisabled"},"aria-expanded":{idn:"ariaExpanded"},"aria-haspopup":{idn:"ariaHasPopup"},"aria-hidden":{idn:"ariaHidden"},"aria-invalid":{idn:"ariaInvalid"},"aria-keyshortcuts":{idn:"ariaKeyShortcuts"},"aria-label":{idn:"ariaLabel"},"aria-level":{idn:"ariaLevel"},"aria-live":{idn:"ariaLive"},"aria-modal":{idn:"ariaModal"},"aria-multiline":{idn:"ariaMultiLine"},"aria-multiselectable":{idn:"ariaMultiSelectable"},"aria-orientation":{idn:"ariaOrientation"},"aria-placeholder":{idn:"ariaPlaceholder"},"aria-posinset":{idn:"ariaPosInSet"},"aria-pressed":{idn:"ariaPressed"},"aria-readonly":{idn:"ariaReadOnly"},"aria-required":{idn:"ariaRequired"},"aria-roledescription":{idn:"ariaRoleDescription"},"aria-rowcount":{idn:"ariaRowCount"},"aria-rowindex":{idn:"ariaRowIndex"},"aria-rowindextext":{idn:"ariaRowIndexText"},"aria-rowspan":{idn:"ariaRowSpan"},"aria-selected":{idn:"ariaSelected"},"aria-setsize":{idn:"ariaSetSize"},"aria-sort":{idn:"ariaSort"},"aria-valuemax":{idn:"ariaValueMax"},"aria-valuemin":{idn:"ariaValueMin"},"aria-valuenow":{idn:"ariaValueNow"},"aria-valuetext":{idn:"ariaValueText"},"http-equiv":{idn:"httpEquiv"},abbr:{},accept:{},accesskey:{idn:"accessKey"},action:{},allow:{},allowfullscreen:{idn:"allowFullscreen"},alt:{},as:{},async:{},autocapitalize:{},autocomplete:{},autofocus:{},autoplay:{},charset:{idn:null},checked:{},cite:{},class:{idn:"className"},color:{idn:null},cols:{idv:C},colspan:{idn:"colSpan",idv:C},content:{},contenteditable:{idn:"contentEditable"},controls:{},coords:{},crossorigin:{idn:"crossOrigin"},data:{},datetime:{idn:"dateTime"},decoding:{},default:{},defer:{},dir:{},dirname:{idn:"dirName"},disabled:{},download:{},draggable:{},enctype:{},enterkeyhint:{idn:"enterKeyHint"},for:{idn:"htmlFor"},form:{idn:null},formaction:{idn:"formAction"},formenctype:{idn:"formEnctype"},formmethod:{idn:"formMethod"},formnovalidate:{idn:"formNoValidate"},formtarget:{idn:"formTarget"},headers:{},height:{idv:C},hidden:{},high:{idv:C},href:{},hreflang:{},id:{},imagesizes:{idn:"imageSizes"},imagesrcset:{idn:"imageSrcset"},indeterminate:{noa:!0},inputmode:{idn:"inputMode"},integrity:{},is:{idn:null},ismap:{idn:"isMap"},itemid:{idn:null},itemprop:{idn:null},itemref:{idn:null},itemscope:{idn:null},itemtype:{idn:null},kind:{},label:{},lang:{},list:{},loading:{},loop:{idv:lt},low:{idv:C},max:{idv:C},maxlength:{idn:"maxLength",idv:C},media:{},method:{},min:{idv:C},minlength:{idn:"minLength",idv:C},multiple:{},muted:{},name:{},nomodule:{idn:"noModule"},nonce:{},novalidate:{idn:"noValidate"},open:{},optimum:{idv:C},pattern:{},ping:{},placeholder:{},playsinline:{idn:"playsInline"},poster:{},preload:{},readonly:{idn:"readOnly"},referrerpolicy:{idn:"referrerPolicy"},rel:{},required:{},reversed:{},role:{},rows:{idv:C},rowspan:{idn:"rowSpan",idv:C},sandbox:{},scope:{},selected:{},shape:{},size:{idv:C},sizes:{},slot:{},span:{idv:C},spellcheck:{},src:{},srcdoc:{},srclang:{},srcset:{},start:{idv:C},step:{idv:C},style:{},tabindex:{idn:"tabIndex",idv:C},target:{},title:{},translate:{idv:ct},type:{},usemap:{idn:"useMap"},width:{idv:C},wrap:{}};function N(e,t,i){i==null||i===!1?e.removeAttribute(t):i===!0?e.setAttribute(t,""):typeof i=="string"?e.setAttribute(t,i):(typeof i=="number"||typeof i=="bigint")&&e.setAttribute(t,i.toString())}function ht(e,t,i){if(!(e instanceof HTMLElement)){N(e,t,i);return}if(t==="value"){switch(e.tagName){case"PROGRESS":case"METER":N(e,t,i),e.value=C(i);break;case"SELECT":e.value=i;break;case"BUTTON":case"DATA":case"INPUT":case"LI":case"OPTION":case"PARAM":case"TEXTAREA":N(e,t,i),e.value=i;break;default:N(e,t,i)}return}const n=dt[t];if(n){if(n.noa||N(e,t,i),n.idn!==null){const s=n.idv?n.idv(i):i;e[n.idn??t]=s}return}N(e,t,i)}var ut=[];function re(e,t,i){const n=e.slice(t,t+i.length);for(let s=0;s<i.length;++s)e[s+t]=n[i[s]-t]}function Ee(e,t,i,n){const s=e.splice(t,i);e.splice(n,0,...s)}function ft(e,t){switch(t.type){case"splice":return t.items?e.splice(t.index,t.count,...t.items):e.splice(t.index,t.count);case"sort":{re(e,t.from,t.indexes);break}case"move":{Ee(e,t.from,t.count,t.to);break}default:F(t)}return ut}function*mt(e,t,i,n){switch(n.type){case"splice":{let s=0,r=0;for(let l=0;l<n.index;++l)s+=l<e.length?e[l]:0;for(let l=0;l<n.count;++l){const a=n.index+l;r+=a<e.length?e[a]:0}const o=[],c=[];if(n.items)for(const l of n.items){const a=t(l);o.push(a.length),c.push(...a)}i.splice(s,r,...c),e.splice(n.index,n.count,...o),yield{type:"splice",index:s,count:r,items:c};break}case"sort":{const s=[];let r=0;for(const d of e)s.push(r),r+=d;const o=e.slice(),c=i.slice(),l=[];let a=0,h=0;for(const d of n.indexes){const u=o[d],y=s[d];for(let x=0;x<u;++x)l.push(y+x),i[h]=c[y+x],h+=1;e[a]=o[d],a+=1}yield{type:"sort",from:s[n.from],indexes:l};break}case"move":{let s=0,r=0,o=0;for(let a=0;a<n.from;++a)s+=e[a];for(let a=0;a<n.count;++a)o+=e[n.from+a];const c=e.splice(n.from,n.count),l=i.splice(s,o);for(let a=0;a<n.to;++a)r+=e[a];e.splice(n.to,0,...c),i.splice(r,0,...l),yield{type:"move",from:s,count:o,to:r};break}default:F(n)}}function oe(e,t){const i=e.length>0?e[e.length-1]:null;if(i&&t.type==="splice"&&i.type==="splice"&&i.index+(i.items?.length??0)===t.index){i.count+=t.count,i.items&&t.items?i.items.push(...t.items):t.items&&(i.items=t.items);return}e.push(t)}var pt=class{constructor(e){this.slots=e.map(()=>0),this.items=e,this.indexes=new Map,this.updateIndexes(0,e.length)}clearSlots(){this.slots=this.items.map(()=>0)}updateIndexes(e,t){for(let i=e;i<t;++i)this.indexes.set(this.items[i],i)}index(e){return this.indexes.get(e)}get(e){return this.items[e]}move(e,t,i){let n=0,s=0,r=0;for(let o=0;o<e;++o)n+=this.slots[o];for(let o=e;o<e+t;++o)s+=this.slots[o];Ee(this.slots,e,t,i),Ee(this.items,e,t,i);for(let o=0;o<i;++o)r+=this.slots[o];return this.updateIndexes(e,e+t),this.updateIndexes(i,i+t),{type:"move",from:n,count:s,to:r}}sort(e,t){let i=0,n=0;const s=[];for(let o=0;o<e+t.length;++o){const c=this.slots[o],l=[];for(let a=0;a<c;++a)l.push(n++);s.push(l),o<e&&(i+=this.slots[o])}re(s,e,t);const r=s.slice(e).flat();return re(this.slots,e,t),re(this.items,e,t),this.updateIndexes(e,e+t.length),{type:"sort",from:i,indexes:r}}splice(e,t,i){let n=0;for(let o=0;o<e;++o)n+=this.slots[o];let s=0;for(let o=e;o<e+t;++o)s+=this.slots[o];this.slots.splice(e,t,...i.map(()=>0));const r=this.items.splice(e,t,...i);for(const o of r)this.indexes.delete(o);return this.items.length===t?this.updateIndexes(e,e+t):this.updateIndexes(e,this.items.length),{removed:r,event:{type:"splice",index:n,count:s,items:[]}}}applyEvent(e,t){const i=this.indexes.get(e);f(i!==void 0,"event from unknown SlotSizes source",e);let n=0;for(let s=0;s<i;++s)n+=this.slots[s];switch(t.type){case"splice":return this.slots[i]+=t.items?.length??0-t.count,{type:"splice",index:t.index+n,count:t.count,items:t.items};case"sort":return{type:"sort",from:t.from+n,indexes:t.indexes.map(s=>s+n)};case"move":return{type:"move",from:t.from+n,count:t.count,to:t.to+n};default:F(t,"unknown ArrayEvent type")}}},yt=()=>{},pe=()=>{throw new Error("Cannot call dead function")};function _e(e,t){return e instanceof Error?e:new Error(t??"Unknown error",{cause:e})}var vt=[0,1,2,3,4],xe={0:new Set,1:new Set,2:new Set,3:new Set,4:new Set},ae,gt=Et;function Et(e){if(window.queueMicrotask){let i=!1;return queueMicrotask(()=>{i||e()}),()=>{i=!0}}const t=setTimeout(e,0);return()=>clearTimeout(t)}function Pe(){for(;ae!==void 0;)ae=void 0,_t()}function _t(){let e=null;for(const t of vt){t===1&&(e=document.activeElement);const i=Array.from(xe[t]).sort((n,s)=>s.getDepth()-n.getDepth());xe[t]=new Set;for(const n of i)n.commit(t);t===3&&e&&document.documentElement.contains(e)&&e.focus()}}function Ue(e,t){xe[t].add(e),ae||(ae=gt(Pe))}function xt(e,t,i,n,s){let r=0;const o={},c=[],l=[];function*a(d){for(const u of e[d]){const y=t[u];y!==void 0&&i<=y&&y<=n&&(yield u)}}const h=d=>{d.index=r,d.lowlink=r,r=r+1,c.push(d),d.onStack=!0;for(const u of a(d.nodeId)){o[u]||(o[u]={nodeId:u});const y=o[u];y.index===void 0?(h(y),d.lowlink=Math.min(d.lowlink,y.lowlink)):y.onStack&&(d.lowlink=Math.min(d.lowlink,y.index))}if(d.lowlink===d.index){const u=[];for(;;){const y=c.pop();if(y.onStack=!1,u.push(y.nodeId),y===d)break}l.push(u)}};for(const d of s)o[d]||(o[d]={nodeId:d},h(o[d]));return l}var P=1,X=2,j=4,D=8,$=class{constructor(e){this.addPostAction=t=>{this.postActions.push(t)},this._processHandler=e,this.nextId=1,this.availableIds=[],this.availableIndices=[],this.vertexById=[],this.vertexToId=new Map,this.vertexBitsById=[],this.cycleInfoById={},this.topologicalIndexById=[],this.topologicalOrdering=[],this.forwardAdjacencyHard=[],this.forwardAdjacencyEither=[],this.reverseAdjacencyEither=[],this.postActions=[],this.startVertexIndex=0,this.toReorderIds=new Set,this.debugSubscriptions=new Set}addVertex(e){f(!this.vertexToId.has(e),"double vertex addition");let t;this.availableIds.length>0?t=this.availableIds.pop():t=this.nextId++,this.vertexToId.set(e,t),this.vertexById[t]=e,this.vertexBitsById[t]=0;let i;this.availableIndices.length>0?i=this.availableIndices.pop():(i=this.topologicalOrdering.length,this.topologicalOrdering.length+=1),this.topologicalIndexById[t]=i,this.topologicalOrdering[i]=t,this.forwardAdjacencyHard[t]=[],this.forwardAdjacencyEither[t]=[],this.reverseAdjacencyEither[t]=[]}removeVertex(e){const t=this.vertexToId.get(e);f(t,"double vertex removal");const i=this.topologicalIndexById[t];f(i!==void 0,"malformed graph"),f(this.forwardAdjacencyEither[t].length===0,"cannot remove vertex with forward edges"),f(this.reverseAdjacencyEither[t].length===0,"cannot remove vertex with reverse edges"),this.topologicalIndexById[t]=void 0,this.topologicalOrdering[i]=void 0,this.clearVertexDirtyInner(t),this.vertexBitsById[t]=0,delete this.cycleInfoById[t],this.vertexToId.delete(e),this.vertexById[t]=void 0,this.toReorderIds.delete(t),this.availableIds.push(t),this.availableIndices.push(i)}hasVertex(e){return this.vertexToId.has(e)}markVertexDirty(e){const t=this.vertexToId.get(e);f(t,"markVertexDirty on nonexistent vertex"),this.markVertexDirtyInner(t)}markVertexDirtyInner(e){const t=this.vertexById[e];if(t&&!(this.vertexBitsById[e]&P)){this.vertexBitsById[e]|=P,this.processHandler(t,0);const i=this.topologicalIndexById[e];i!==void 0&&i<this.startVertexIndex&&(this.startVertexIndex=i)}}clearVertexDirty(e){const t=this.vertexToId.get(e);f(t,"markVertexDirty on nonexistent vertex"),this.clearVertexDirtyInner(t)}clearVertexDirtyInner(e){this.vertexBitsById[e]&P&&(this.vertexBitsById[e]&=~P)}markVertexCycleInformed(e){const t=this.vertexToId.get(e);f(t,"markVertexCycleInformed on nonexistent vertex"),this.vertexBitsById[t]|=D}*cycleAwareAdjacency(e,t,i){if(t){const n=new Set;for(const s of t.vertexIds)for(const r of i[s])!t.vertexIds.has(r)&&!n.has(r)&&(n.add(r),yield r);return}for(const n of i[e])n!==e&&(yield n)}addEdge(e,t,i){const n=this.vertexToId.get(e),s=this.vertexToId.get(t);if(f(n,"addEdge from vertex not found"),f(s,"addEdge to vertex not found"),this.forwardAdjacencyEither[n].push(s),this.reverseAdjacencyEither[s].push(n),i===2&&this.forwardAdjacencyHard[n].push(s),n===s&&!(this.vertexBitsById[n]&j))if(this.vertexBitsById[n]&D)this.vertexBitsById[n]|=j;else{const a=this.vertexById[n];f(a,"missing vertex in self-cycle"),this.processHandler(a,2),this.vertexBitsById[n]|=D|j}const r=this.topologicalIndexById[n],o=this.topologicalIndexById[s];f(o!==void 0,"malformed graph"),f(r!==void 0,"malformed graph"),r>o&&(this.toReorderIds.add(n),this.toReorderIds.add(s))}hasEdge(e,t,i){const n=this.vertexToId.get(e),s=this.vertexToId.get(t);return f(n,"addEdge from vertex not found"),f(s,"addEdge to vertex not found"),this.forwardAdjacencyEither[n].includes(s)}removeEdge(e,t,i){const n=this.vertexToId.get(e),s=this.vertexToId.get(t);f(n,"removeEdge from vertex not found"),f(s,"removeEdge to vertex not found"),ye(this.forwardAdjacencyEither[n],s),ye(this.reverseAdjacencyEither[s],n),i===2&&ye(this.forwardAdjacencyHard[n],s),n===s&&(this.vertexBitsById[n]=this.vertexBitsById[n]&~j);const r=this.cycleInfoById[n],o=this.cycleInfoById[s];r&&o&&r===o&&(this.toReorderIds.add(n),this.toReorderIds.add(s))}visitDfsForwardRecurse(e,t,i,n){if(!n.has(e)){n.add(e);for(const s of this.forwardAdjacencyEither[e]){const r=this.topologicalIndexById[s];f(r!==void 0,"malformed graph"),t<=r&&r<=i&&this.visitDfsForwardRecurse(s,t,i,n)}}}visitDfsForward(e,t,i){const n=new Set;for(const s of e)this.visitDfsForwardRecurse(s,t,i,n);return n}resort(e){let t=1/0,i=-1/0;for(const c of e){const l=this.cycleInfoById[c];if(l)l.lowerBound<t&&(t=l.lowerBound),l.upperBound>i&&(i=l.upperBound);else{const a=this.topologicalIndexById[c];f(a!==void 0,"malformed graph"),a<t&&(t=a),a>i&&(i=a)}}const n=this.visitDfsForward(e,t,i),s=xt(this.reverseAdjacencyEither,this.topologicalIndexById,t,i,n),r=[];for(const c of s){let l;c.length>1&&(l={upperBound:-1/0,lowerBound:1/0,vertexIds:new Set(c)});for(const a of c){const h=this.topologicalIndexById[a];if(f(h!==void 0,"malformed graph"),l){if(h<l.lowerBound&&(l.lowerBound=h),h>l.upperBound&&(l.upperBound=h),this.vertexBitsById[a]&X||(this.vertexBitsById[a]|=X),!(this.vertexBitsById[a]&D)){const d=this.vertexById[a];f(d,"uninformed vertex missing"),this.processHandler(d,2),this.vertexBitsById[a]|=D}this.cycleInfoById[a]=l}else this.vertexBitsById[a]&X&&(this.vertexBitsById[a]=this.vertexBitsById[a]&~(X|D),delete this.cycleInfoById[a],this.markVertexDirtyInner(a));r.push(h)}}r.sort((c,l)=>c-l);let o=0;for(const c of s)for(const l of c){const a=r[o];this.topologicalOrdering[a]=l,this.topologicalIndexById[l]=a,o+=1}return t}processHandler(e,t){return this._processHandler(e,t,this.addPostAction)}processVertex(e){const t=this.vertexById[e];return f(t,"nonexistent vertex dirtied"),this.processHandler(t,1)}process(){for(this.toReorderIds.size>0&&(this.resort(this.toReorderIds),this.toReorderIds.clear());;){const e=this.startVertexIndex;if(e>=this.vertexById.length){const l=this.postActions;this.postActions=[];for(const a of l)a();if(e!==this.startVertexIndex)continue;this.startVertexIndex=0;break}this.startVertexIndex++;const t=this.topologicalOrdering[e];if(t===void 0||!(this.vertexBitsById[t]&P))continue;const n=this.vertexById[t];f(n,"nonexistent vertex dirtied");const s=this.cycleInfoById[t];let r=!1;const o=s||this.vertexBitsById[t]&j?[]:null;if(s)for(const l of s.vertexIds){if(!this.vertexById[l])continue;this.vertexBitsById[l]&D&&o.push(l),r=this.processVertex(l)||r}else this.vertexBitsById[t]&D&&o&&o.push(t),r=this.processVertex(t)||r;if(this.toReorderIds.size>0){const l=this.resort(this.toReorderIds);l<this.startVertexIndex&&(this.startVertexIndex=l),this.toReorderIds.clear()}if(o){for(const l of o)if(this.vertexBitsById[l]&(X|j)){const h=this.vertexById[l];f(h,"nonexistent vertex in cycle"),r=this.processHandler(h,2)||r}}const c=this.cycleInfoById[t];if(!s&&c&&(r=!0),s&&!c&&(r=!0),s&&c&&c.vertexIds!==s.vertexIds&&(r=!0),r){const l=new Set;if(l.add(t),s)for(const a of s.vertexIds)l.add(a);if(c)for(const a of c.vertexIds)l.add(a);for(const a of l)this.vertexById[a]&&this.propagateDirty(a,l)}else this.clearVertexDirtyInner(t)}}getOrderedDirty(){this.toReorderIds.size>0&&(this.resort(this.toReorderIds),this.toReorderIds.clear());const e=[];for(let t=0;t<this.topologicalOrdering.length;++t){const i=this.topologicalOrdering[t];if(i===void 0||!(this.vertexBitsById[i]&P))continue;const s=this.vertexById[i];f(s,"nonexistent vertex dirtied"),e.push(s)}return e}propagateDirty(e,t){this.clearVertexDirtyInner(e);for(const i of this.forwardAdjacencyHard[e]){const n=this.cycleInfoById[i];if(n)for(const s of n.vertexIds)(!t||!t.has(s))&&this.markVertexDirtyInner(s);else(!t||!t.has(i))&&this.markVertexDirtyInner(i)}}debug(e,t){const i=[];i.push("digraph dependencies {"),i.push("  graph [];"),i.push("  edge [penwidth=2.0];"),i.push("  node [penwidth=2.0];"),t&&i.push(`  graph [label=${JSON.stringify(t)};]`);const n=r=>{const o=this.vertexById[r];if(!o)return;const c=e(o),l={style:"filled",label:`${r}
${c.name}`};l.shape="ellipse",this.vertexBitsById[r]&P?(l.style="filled",l.fontcolor="#FFFFFF",l.fillcolor="#FC7A1E"):(l.style="filled",l.fontcolor="#000000",l.fillcolor="#FFFFFF"),c.isActive&&(l.penwidth=4,l.pencolor="#485696");const a=[];for(const[h,d]of Object.entries(l))a.push(`${h}=${JSON.stringify(d)}`);i.push(`  v_${r} [${a.join(",")}]`)},s=new Set;for(let r=0;r<this.vertexById.length;++r){const o=this.cycleInfoById[r];o&&s.add(o)}for(const r of s){i.push("  subgraph cluster_cycle {"),i.push('  graph [label="cycle";]');for(const o of r.vertexIds)n(o);i.push("  }")}for(let r=0;r<this.vertexById.length;++r)this.cycleInfoById[r]||n(r);for(let r=0;r<this.vertexById.length;++r){const o=new Set(this.forwardAdjacencyHard[r]||[]);if(this.forwardAdjacencyEither[r])for(const c of this.forwardAdjacencyEither[r])o.has(c)?i.push(`  v_${r} -> v_${c};`):i.push(`  v_${r} -> v_${c} [style="dotted"];`)}return i.push("}"),i.join(`
`)}debugSubscribe(e,t){const i={formatter:e,subscription:t};return this.debugSubscriptions.add(i),()=>{this.debugSubscriptions.delete(i)}}debugGetGraph(){const e=[];for(let i=0;i<this.vertexById.length;++i){const n=this.vertexById[i];n&&e.push(n)}const t=[];for(let i=0;i<this.vertexById.length;++i)if(this.forwardAdjacencyEither[i])for(const n of this.forwardAdjacencyEither[i]){const s=this.vertexById[i],r=this.vertexById[n];s&&r&&t.push([s,r])}return{vertices:e,edges:t}}_test_getVertices(){return pe()}_test_getDependencies(e){return pe()}_test_getVertexInfo(e){return pe()}};$.EDGE_SOFT=1;$.EDGE_HARD=2;function ye(e,t){if(t===e[e.length-1]){e.pop();return}const i=e.indexOf(t);e[i]=e[e.length-1],e.pop()}function ve(e){return e&&e.__processable===!0}var A=new $(wt),Ae=new Set,q=[],W=[],be=!1,Y=!1,J=null,bt=It;function It(e){if(window.queueMicrotask){let i=!1;return queueMicrotask(()=>{i||e()}),()=>{i=!0}}const t=setTimeout(e,0);return()=>clearTimeout(t)}function Mt(){Y||(Y=!0,J=bt(()=>{Y=!1,J=null,Ke()}))}function le(){be||(J&&(J(),J=null),Y=!1,Ke())}function M(e){e.__refcount+=1,e.__refcount===1&&e.__alive()}function b(e){f(e.__refcount>0,"double release"),e.__refcount===1&&e.__dead(),e.__refcount-=1}function wt(e,t,i){switch(t){case 0:return e.__invalidate?.()??!1;case 1:return e.__recalculate?.(i)??!1;case 2:return e.__cycle?.(i)??!1;default:F(t,"unknown action")}}function Ke(){be=!0,A.process();const e=Ae;Ae=new Set;for(const t of e)t();Pe(),be=!1,Y&&le()}function de(e){A.addVertex(e)}function he(e){A.removeVertex(e)}function qe(e,t){A.addEdge(e,t,$.EDGE_HARD)}function U(e,t){A.addEdge(e,t,$.EDGE_SOFT)}function Ie(e,t){A.removeEdge(e,t,$.EDGE_HARD)}function K(e,t){A.removeEdge(e,t,$.EDGE_SOFT)}function Ce(e){A.markVertexDirty(e),Mt()}function Re(e){A.clearVertexDirty(e)}function Tt(e){A.markVertexCycleInformed(e)}function Ct(e,t,i){q.push(e);try{return t()}finally{f(e===q.pop(),"Calculation tracking consistency error")}}function Z(e,t){q.push(null);try{return e()}finally{f(q.pop()===null,"Calculation tracking consistency error")}}function Ht(e,t,i){W.push(e);try{return t()}finally{f(e===W.pop(),"Calculation tracking consistency error")}}function ze(e){if(W.length===0)return;const t=W[W.length-1];t&&(t.has(e)||t.add(e))}function R(e){if(q.length===0)return;const t=q[q.length-1];t&&(t.has(e)||(M(e),t.add(e)))}var O=class{constructor(e,t,i){this.handleEvent=n=>{n.type==="splice"&&(this.liveNodes+=(n.items?.length??0)-n.count),this.handlers.onEvent?.(n)||(f(this.parentContext,"Unexpected event on detached RenderNode"),this.parentContext.nodeEmitter(n))},this.handleError=n=>{this.handlers.onError?.(n)||(this.parentContext?this.parentContext.errorEmitter(n):V("Unhandled error on detached RenderNode",n))},this.handlers=e,this.child=t,this._isMounted=!1,this.parentContext=void 0,this.liveNodes=0,this.depth=0,this.__debugName=i??"custom",this.__refcount=0}isAttached(){return!!this.parentContext}isMounted(){return this._isMounted}emitEvent(e){f(this.parentContext,"RenderNode attempted to emit event when detached"),this.parentContext.nodeEmitter(e)}emitError(e){f(this.parentContext,"RenderNode attempted to emit error when detached"),this.parentContext.errorEmitter(e)}commit(e){this.handlers.onCommit?.(e)}requestCommit(e){Ue(this,e)}clone(e,t){if(this.handlers.clone)return this.handlers.clone(e,t);const i=this.child.clone();return new O(this.handlers,i)}setChild(e){const t=this.child;this.child=e,this._isMounted&&t.onUnmount(),this.parentContext&&(this.liveNodes>0&&this.parentContext.nodeEmitter({type:"splice",index:0,count:this.liveNodes}),t.detach()),this.liveNodes=0,this.disown(t),this.own(this.child),this.parentContext&&this.child.attach({nodeEmitter:this.handleEvent,errorEmitter:this.handleError,xmlNamespace:this.parentContext.xmlNamespace}),this._isMounted&&this.child.onMount()}detach(){f(this.parentContext,"double detached"),this.child.detach(),this.parentContext=void 0,this.handlers.onDetach?.()}attach(e){f(!this.parentContext,"Invariant: double attached"),this.parentContext=e,this.child.attach({nodeEmitter:this.handleEvent,errorEmitter:this.handleError,xmlNamespace:this.parentContext.xmlNamespace}),this.handlers.onAttach?.(e)}onMount(){this._isMounted=!0,this.child.onMount(),this.handlers.onMount?.()}onUnmount(){this._isMounted=!1,this.child.onUnmount(),this.handlers.onUnmount?.()}retain(){M(this)}release(){b(this)}__alive(){this.own(this.child),this.handlers.onAlive?.()}__dead(){this.handlers.onDestroy?.(),this.disown(this.child),this.parentContext=void 0}own(e){e!==w&&(e.setDepth(this.depth+1),e.retain())}disown(e){e!==w&&(e.release(),e.setDepth(0))}getDepth(){return this.depth}setDepth(e){this.depth=e}},ue=class{constructor(e,t,i){this.handleError=n=>{this.handlers.onError?.(n)||(this.parentContext?this.parentContext.errorEmitter(n):V("Unhandled error on detached RenderNode",n))},this.depth=0,this.handlers=e,this._isMounted=!1,this.slotSizes=new pt(t),this.parentContext=void 0,this.pendingCommit=void 0,this.__debugName=i??"custom",this.__refcount=0}isAttached(){return!!this.parentContext}isMounted(){return this._isMounted}emitEvent(e){f(this.parentContext,"RenderNode attempted to emit event when detached"),this.parentContext.nodeEmitter(e)}emitError(e){f(this.parentContext,"RenderNode attempted to emit error when detached"),this.parentContext.errorEmitter(e)}commit(e){this.handlers.onCommit?.(e)}requestCommit(e){Ue(this,e)}clone(e,t){if(this.handlers.clone)return this.handlers.clone(e,t);const i=this.slotSizes.items.map(n=>n.clone());return new ue(this.handlers,i)}sortChildren(e,t){const i=this.slotSizes.sort(e,t);this.parentContext?.nodeEmitter(i)}moveChildren(e,t,i){const n=this.slotSizes.move(e,t,i);this.parentContext?.nodeEmitter(n)}spliceChildren(e,t,i){for(let r=e;r<e+t;++r){const o=this.slotSizes.items[r];this._isMounted&&o.onUnmount()}const{removed:n,event:s}=this.slotSizes.splice(e,t,i);this.parentContext&&s.count>0&&this.parentContext.nodeEmitter({type:"splice",index:s.index,count:s.count});for(const r of n)this.parentContext&&r.detach(),this.disown(r);for(const r of i)this.own(r),this.parentContext&&r.attach({nodeEmitter:o=>this.handleChildEvent(r,o),errorEmitter:this.handleError,xmlNamespace:this.parentContext.xmlNamespace}),this._isMounted&&r.onMount()}handleChildEvent(e,t){if(!this.handlers.onChildEvent?.(e,t)){const i=this.slotSizes.applyEvent(e,t);this.handleEvent(i)}}handleEvent(e){this.handlers.onEvent?.(e)||(f(this.parentContext,"Unexpected event on detached RenderNode"),this.parentContext.nodeEmitter(e))}detach(){f(this.parentContext,"double detached"),this.slotSizes.clearSlots();for(const e of this.slotSizes.items)e.detach();this.parentContext=void 0,this.handlers.onDetach?.()}attach(e){f(!this.parentContext,"Invariant: double attached"),this.parentContext=e;for(const t of this.slotSizes.items)t.attach({nodeEmitter:i=>{this.handleChildEvent(t,i)},errorEmitter:this.handleError,xmlNamespace:this.parentContext.xmlNamespace});this.handlers.onAttach?.(e)}onMount(){this._isMounted=!0;for(const e of this.slotSizes.items)e.onMount();this.handlers.onMount?.()}onUnmount(){this._isMounted=!1;for(const e of this.slotSizes.items)e.onUnmount();this.handlers.onUnmount?.()}retain(){M(this)}release(){b(this)}__alive(){for(const e of this.slotSizes.items)this.own(e);this.handlers.onAlive?.()}__dead(){this.handlers.onDestroy?.();for(const e of this.slotSizes.items)this.disown(e);this.parentContext=void 0}own(e){e!==w&&(e.setDepth(this.depth+1),e.retain())}disown(e){e!==w&&(e.release(),e.setDepth(0))}getDepth(){return this.depth}setDepth(e){this.depth=e}},Ge=class{constructor(){this.__debugName="<empty>",this.__refcount=1}detach(){}attach(){}onMount(){}onUnmount(){}retain(){}release(){}commit(){}getDepth(){return 0}setDepth(){}clone(){return w}__alive(){}__dead(){}},w=new Ge;function St(e){return e&&(e instanceof O||e instanceof ue||e instanceof Ge)}function te(e,t){return e.length===0?w:e.length===1?e[0]:new ue({},e,t)}function $e(e,t,i){let n,s,r,o=!1;const c=(a,h)=>{a?(l.setChild(w),n=a,l.isAttached()?l.emitError(a):V("Unhandled error on detached DynamicRenderNode",h)):o?l.setChild(e(h)):(l.setChild(w),r=h,l.requestCommit(2))},l=new O({onAttach:a=>{n&&a.errorEmitter(n)},onCommit:a=>{a===2&&l.setChild(e(r))},clone:()=>$e(e,t),onAlive:()=>{o=!0,s=t.subscribe(c),o=!1},onDestroy:()=>{n=void 0,s?.(),s=void 0}},w,"DynamicRenderNode");return l}function He(e,t){return new O({onAttach:i=>{i.nodeEmitter({type:"splice",index:0,count:0,items:[e]})},clone:()=>He(e)},w,"foreign")}function Me(e,t){const i=document.createTextNode(e);return new O({onAttach:n=>{n.nodeEmitter({type:"splice",index:0,count:0,items:[i]})},clone:()=>Me(e)},w,"text")}function z(e){return St(e)?e:Oe(e)?e.__renderNode(z):e instanceof Node?He(e):Array.isArray(e)?te(e.map(t=>z(t))):e==null||typeof e=="boolean"?w:typeof e=="function"?(V("Rendering a function as JSX renders to nothing"),w):typeof e=="symbol"?(V("Rendering a symbol as JSX renders to nothing"),w):typeof e=="string"?Me(e):typeof e=="number"||typeof e=="bigint"?Me(e.toString()):typeof e=="object"&&typeof e.get=="function"&&typeof e.subscribe=="function"?$e(z,e):(V("Unexpected JSX node type, rendering nothing",e),w)}function je(e){const t=[];if(e)if(Array.isArray(e)&&!Oe(e))for(const i of e)t.push(z(i));else t.push(z(e));return t}var Lt=class{constructor(e){this.props=e}};function Se(e,t,i,n){let s,r,o,c,l=new Set,a;function h(){if(!s){let u=!0;const y={onMount:p=>{f(u,"onMount must be called in component body"),r||(r=[]),r.push(p)},onUnmount:p=>{f(u,"onUnmount must be called in component body"),o||(o=[]),o.push(p)},onDestroy:p=>{f(u,"onDestroy must be called in component body"),c||(c=[]),c.push(p)},onError:p=>{f(u,"onError must be called in component body"),f(!a,"onError called multiple times"),a=p}};let x;i.length===0?x=t||{}:i.length===1?x=t?{...t,children:i[0]}:{children:i[0]}:x=t?{...t,children:i}:{children:i};let I;try{I=Ht(l,()=>e(x,y)||w)}catch(p){const g=_e(p,"Unknown error rendering component");a?I=a(g)??w:I=g}u=!1;for(const p of l)M(p);I instanceof Error?s=I:s=z(I)}return s}const d=new O({onAlive:()=>{const u=h();u instanceof Error?V("Unhandled exception on detached component",{error:u,renderNode:d}):d.own(u)},onDestroy:()=>{if(s&&!(s instanceof Error)&&d.disown(s),c)for(const u of c)u();for(const u of l)b(u);l=new Set,r=void 0,o=void 0,c=void 0,s=void 0,a=void 0},onAttach:u=>{s instanceof Error?u.errorEmitter(s):s&&d.setChild(s)},onDetach:()=>{d.setChild(w)},onError:u=>{if(a){const y=a(u);return s=y?z(y):w,d.setChild(s),!0}},onMount:()=>{f(s,"Invariant: missing result"),!(s instanceof Error)&&d.requestCommit(4)},onUnmount:()=>{if(f(s,"Invariant: missing result"),!(s instanceof Error)&&o)for(const u of o)u()},onCommit:u=>{if(u===4&&r)for(const y of r){const x=y();if(typeof x=="function"){o||(o=[]);const I=()=>{if(x(),o){const p=o.indexOf(I);p>=0&&o.splice(p,1)}};o.push(I)}}},clone(u,y){return Se(e,t&&u?{...t,...u}:u||t,y??i)}},w,`component(${e.name})`);return d}function we(e){return Le(e)?e.get():e}function kt(e,t){return Le(e)?e.subscribe(t):(t(void 0,e),yt)}function Le(e){return e&&typeof e=="object"&&"subscribe"in e}var Bt=()=>({a:HTMLAnchorElement,abbr:HTMLElement,address:HTMLElement,area:HTMLAreaElement,article:HTMLElement,aside:HTMLElement,audio:HTMLAudioElement,b:HTMLElement,base:HTMLBaseElement,bdi:HTMLElement,bdo:HTMLElement,blockquote:HTMLQuoteElement,body:HTMLBodyElement,br:HTMLBRElement,button:HTMLButtonElement,canvas:HTMLCanvasElement,caption:HTMLTableCaptionElement,cite:HTMLElement,code:HTMLElement,col:HTMLTableColElement,colgroup:HTMLTableColElement,data:HTMLDataElement,datalist:HTMLDataListElement,dd:HTMLElement,del:HTMLModElement,details:HTMLDetailsElement,dfn:HTMLElement,dialog:HTMLDialogElement,div:HTMLDivElement,dl:HTMLDListElement,dt:HTMLElement,em:HTMLElement,embed:HTMLEmbedElement,fieldset:HTMLFieldSetElement,figcaption:HTMLElement,figure:HTMLElement,footer:HTMLElement,form:HTMLFormElement,h1:HTMLHeadingElement,h2:HTMLHeadingElement,h3:HTMLHeadingElement,h4:HTMLHeadingElement,h5:HTMLHeadingElement,h6:HTMLHeadingElement,head:HTMLHeadElement,header:HTMLElement,hgroup:HTMLElement,hr:HTMLHRElement,html:HTMLHtmlElement,i:HTMLElement,iframe:HTMLIFrameElement,img:HTMLImageElement,input:HTMLInputElement,ins:HTMLModElement,kbd:HTMLElement,label:HTMLLabelElement,legend:HTMLLegendElement,li:HTMLLIElement,link:HTMLLinkElement,main:HTMLElement,map:HTMLMapElement,mark:HTMLElement,menu:HTMLMenuElement,meta:HTMLMetaElement,meter:HTMLMeterElement,nav:HTMLElement,noscript:HTMLElement,object:HTMLObjectElement,ol:HTMLOListElement,optgroup:HTMLOptGroupElement,option:HTMLOptionElement,output:HTMLOutputElement,p:HTMLParagraphElement,picture:HTMLPictureElement,pre:HTMLPreElement,progress:HTMLProgressElement,q:HTMLQuoteElement,rp:HTMLElement,rt:HTMLElement,ruby:HTMLElement,s:HTMLElement,samp:HTMLElement,script:HTMLScriptElement,section:HTMLElement,select:HTMLSelectElement,slot:HTMLSlotElement,small:HTMLElement,source:HTMLSourceElement,span:HTMLSpanElement,strong:HTMLElement,style:HTMLStyleElement,sub:HTMLElement,summary:HTMLElement,sup:HTMLElement,table:HTMLTableElement,tbody:HTMLTableSectionElement,td:HTMLTableCellElement,template:HTMLTemplateElement,textarea:HTMLTextAreaElement,tfoot:HTMLTableSectionElement,th:HTMLTableCellElement,thead:HTMLTableSectionElement,time:HTMLTimeElement,title:HTMLTitleElement,tr:HTMLTableRowElement,track:HTMLTrackElement,u:HTMLElement,ul:HTMLUListElement,var:HTMLElement,video:HTMLVideoElement,wbr:HTMLElement}),ce="http://www.w3.org/1999/xhtml",m="http://www.w3.org/2000/svg",E="http://www.w3.org/1998/Math/MathML",At={animate:m,animateMotion:m,animateTransform:m,circle:m,clipPath:m,defs:m,desc:m,discard:m,ellipse:m,feBlend:m,feColorMatrix:m,feComponentTransfer:m,feComposite:m,feConvolveMatrix:m,feDiffuseLighting:m,feDisplacementMap:m,feDistantLight:m,feDropShadow:m,feFlood:m,feFuncA:m,feFuncB:m,feFuncG:m,feFuncR:m,feGaussianBlur:m,feImage:m,feMerge:m,feMergeNode:m,feMorphology:m,feOffset:m,fePointLight:m,feSpecularLighting:m,feSpotLight:m,feTile:m,feTurbulence:m,filter:m,foreignObject:m,g:m,hatch:m,hatchpath:m,image:m,line:m,linearGradient:m,marker:m,mask:m,metadata:m,mpath:m,path:m,pattern:m,polygon:m,polyline:m,radialGradient:m,rect:m,set:m,stop:m,svg:m,switch:m,symbol:m,text:m,textPath:m,tspan:m,use:m,view:m,math:E,maction:E,annotation:E,"annotation-xml":E,menclose:E,merror:E,mfenced:E,mfrac:E,mi:E,mmultiscripts:E,mn:E,none:E,mo:E,mover:E,mpadded:E,mphantom:E,mprescripts:E,mroot:E,mrow:E,ms:E,semantics:E,mspace:E,msqrt:E,mstyle:E,msub:E,msup:E,msubsup:E,mtable:E,mtd:E,mtext:E,mtr:E,munder:E,munderover:E},De={[ce]:{svg:{node:m,children:m},math:{node:E,children:E}},[m]:{foreignObject:{node:m,children:ce}}},Ne=class{constructor(e){this.current=e}},ge;function Rt(){return ge||(ge=document.createDocumentFragment()),ge}function Xe(e,t,i,n){let s=[],r=[],o=new Set,c=new Set;function l(h,d){let u;if(h.length===1)u=h[0],o.add(h[0]),s.splice(d,0,u);else if(h.length>1){const y=Rt();for(const x of h)o.add(x),y.appendChild(x);s.splice(d,0,...h),u=y}u&&e.insertBefore(u,e.childNodes[d]||null)}const a=new O({onEvent:h=>{const d=ft(r,h);for(const x of d)o.has(x)&&c.add(x);const u=h.type!=="splice"||h.count>0,y=h.type!=="splice"||h.items?.length;return u&&a.requestCommit(1),y&&a.requestCommit(3),!0},onMount:()=>{i&&a.requestCommit(4)},onUnmount:()=>{i&&a.requestCommit(0)},onCommit:h=>{if(h===0&&i&&(i instanceof Ne?i.current=void 0:typeof i=="function"&&i(void 0)),h===1&&c.size>0){if(c.size===o.size)e.replaceChildren(),o.clear(),s=[];else{for(const d of c)o.delete(d),e.removeChild(d);s=s.filter(d=>!c.has(d))}c.clear()}if(h===3&&r.length>0){let d=0;for(;d<r.length;){if(d>=s.length){l(r.slice(d),d);break}if(r[d]!==s[d]){let u=d+1;for(;u<r.length&&u<s.length&&r[u]!==s[d];)u++;l(r.slice(d,u),d),d=u;continue}d++}}h===4&&i&&(i instanceof Ne?i.current=e:typeof i=="function"&&i(e))},clone(){f(!1,"Attempted to clone a PortalRenderNode -- this operation doesn't make sense")},onDestroy:()=>{s=[],r=[],o=new Set,c=new Set}},t,`mount(${e instanceof Element?e.tagName:`shadow(${e.host.tagName})`})`);return a}var Dt=[{prefix:"on:",param:!1},{prefix:"oncapture:",param:!0},{prefix:"onpassive:",param:{passive:!0}}];function We(e,t,i,n){let s,r,o,c,l,a;function h(p){f(!1,"unexpected event in IntrinsicRenderNode from PortalRenderNode")}function d(p){if(I.isAttached())I.emitError(p);else return V("Unhandled error on detached IntrinsicRenderNode",n,p),a=p,!0}function u(p,g,_){return(!o||g!==c)&&(c=g,o=y(g),l&&(I.isMounted()&&l.onUnmount(),l.detach(),I.disown(l)),l=Xe(o,i,t?.ref),I.own(l),l.attach({nodeEmitter:h,errorEmitter:d,xmlNamespace:_}),I.isMounted()&&l.onMount()),o}function y(p){let g;if(typeof t?.is=="string"&&e in Bt()?g=document.createElement(e,{is:t.is}):g=document.createElementNS(p,e),t){for(const[_,T]of Object.entries(t))_!=="ref"&&_!=="is"&&(Dt.some(({prefix:ie,param:me})=>_.startsWith(ie)?(T&&g.addEventListener(_.slice(ie.length),ne=>{T(ne,g),le()},me),!0):!1)||(Le(T)?(s||(s=new Map),s.set(_,T)):x(g,_,we(T))));if(s){r||(r=new Set);for(const[_,T]of s.entries()){r.add(kt(T,(me,ne)=>{me?ee("Unhandled error in bound prop",{prop:_,element:g,error:ne}):x(g,_,ne)}));const ie=we(T);x(g,_,ie)}}}return g}function x(p,g,_){if(g.startsWith("prop:")){const T=g.slice(5);p[T]=_;return}if(g.startsWith("attr:")){const T=g.slice(5);N(p,T,_);return}if((p instanceof HTMLElement||p instanceof SVGElement)&&(g.startsWith("cssprop:")||g.startsWith("style:"))){const T=g.startsWith("cssprop:")?"--"+g.slice(8):g.slice(6);_==null||_===!1?p.style.removeProperty(T):typeof _=="string"?p.style.setProperty(T,_):(typeof _=="number"||typeof _=="bigint")&&p.style.setProperty(T,_.toString());return}if(g.startsWith("style:")){const T=g.slice(6);N(p,T,_);return}ht(p,g,_)}const I=new O({onAttach:p=>{if(a){p.errorEmitter(a);return}const g=De[p.xmlNamespace]?.[e],_=g?.node??p.xmlNamespace,T=g?.children??p.xmlNamespace;o=u(p,_,T),p.nodeEmitter({type:"splice",index:0,count:0,items:[o]})},onDetach:()=>{},onMount:()=>{l?.onMount()},onUnmount:()=>{l?.onUnmount()},clone:(p,g)=>We(e,p?{...t,...p}:t,g?te(g??[]):i.clone()),onAlive:()=>{const p=At[e]??ce,g=De[p]?.[e]?.children??p;o=u({nodeEmitter:_=>{H("IntrinsicRenderNode got unexpected node event",_)},errorEmitter:_=>{H("IntrinsicRenderNode got unexpected error event",_)},xmlNamespace:p},p,g)},onDestroy:()=>{if(s=void 0,r){for(const p of r)p();r=void 0}o=void 0,c=void 0,l&&(I.disown(l),l=void 0),a=void 0}},w,`intrinsic(${e})`);return I}var Nt=({children:e})=>te(je(e));function Ft(e){return e&&e.prototype instanceof Lt}function Vt(e,t,i){return Se((n,s)=>{const r=new e(n);return r.render?(r.onDestroy&&s.onDestroy(r.onDestroy.bind(r)),r.onMount&&s.onMount(r.onMount.bind(r)),r.onError&&s.onError(r.onError.bind(r)),r.onUnmount&&s.onUnmount(r.onUnmount.bind(r)),r.render()):null},t,i)}function Ye(e,t,...i){return typeof e=="string"?We(e,t,te(je(i))):Ft(e)?Vt(e,t,i):Se(e,t,i)}Ye.Fragment=Nt;var k=Symbol("sentinel"),Ot=Symbol("calculation"),Pt=class{get(){R(this);const e=this._state;switch(e){case 4:return this._fn();case 2:return this._val;case 1:throw this._state=3,this._error=new se("Cycle reached: calculation reached itself",this),this._error;case 3:throw this._error===k?new Error("Cycle reached: calculation reached itself"):new Error("Calculation in error state: "+this._error.message);case 0:{const t=new Set;let i=k,n;this._state=1;try{i=Ct(t,()=>this._fn(),this.__debugName)}catch(o){n=o}if(this._state===4){for(const o of t)b(o);if(i===k)throw n;return i}this._state===3&&(n=this._error);let s=!1,r=!1;if(n){n instanceof se&&(s=!0,r=n.sourceCalculation===this);const o=this._errorHandler;o&&(i=Z(()=>o(n),this.__debugName)),s&&Tt(this)}if(i===k?("_val"in this&&delete this._val,this._error=n,this._state=3):(this._val=i,"_error"in this&&delete this._error,this._state=2,Re(this)),this._retained)for(const o of this._retained)ve(o)&&!t.has(o)&&Ie(o,this),b(o);for(const o of t)ve(o)&&(!this._retained||!this._retained.has(o))&&qe(o,this);if(this._retained=t,i===k)throw n;if(s&&!r)throw n;return i}default:F(e,"Calculation in unknown state")}}constructor(e,t){this.__debugName=t??"calc",this.__refcount=0,this.__processable=!0,this._type=Ot,this._state=4,this._fn=e}onError(e){return this._errorHandler=e,this}_eq(e,t){return e===t}setCmp(e){return this._eq=e,this}subscribe(e){M(this);let t;try{t=[void 0,this.get()]}catch(n){t=[_e(n),void 0]}this._subscriptions||(this._subscriptions=new Set),this._subscriptions.add(e);const i=()=>{this._subscriptions?.delete(e),b(this)};return e(...t),i}retain(){M(this)}release(){b(this)}__alive(){de(this),this._state=0}__dead(){if(this._retained)for(const e of this._retained)ve(e)&&Ie(e,this),b(e);delete this._retained,he(this),this._state=4,delete this._val}__recalculate(){switch(this._state){case 4:H("cannot recalculate dead calculation");break;case 1:H("cannot recalculate calculation being tracked");break;case 0:case 3:case 2:{const e="_val"in this?this._val:k;this._state=0;let t;try{t=this.get()}catch(i){if(this._state=3,this._error=i,this._subscriptions){const n=_e(i,"Unknown error in calculation");for(const s of this._subscriptions)s(n,void 0)}return!0}if(e!==k&&this._eq(e,t))return this._val=e,!1;if(this._subscriptions)for(const i of this._subscriptions)i(void 0,t);return!0}default:F(this._state,"Calculation in unknown state")}}__invalidate(){switch(this._state){case 4:H("cannot invalidate dead calculation");break;case 1:H("cannot invalidate calculation being tracked");break;case 0:return!1;case 3:return this._state=0,!1;case 2:return this._state=0,!0;default:F(this._state,"Calculation in unknown state")}}__cycle(){switch(this._state){case 4:H("cannot trigger cycle on dead calculation");break;case 1:H("cannot trigger cycle on calculation being tracked");break;case 3:case 2:case 0:{const e="_val"in this?this._val:k;this._state=0;const t=this._errorHandler;if(t)this._val=Z(()=>t(new se("Calculation is part of a cycle",this)),this.__debugName),this._state=2,Re(this);else{if(this._state=3,this._error=k,this._subscriptions)for(const i of this._subscriptions)i(new se("Calculation is part of a cycle",this),void 0);return!0}if(e!==k&&this._eq(e,this._val))return this._val=e,!1;if(this._subscriptions)for(const i of this._subscriptions)i(void 0,this._val);return!0}default:F(this._state,"Calculation in unknown state")}}},se=class extends Error{constructor(e,t){super(e),this.sourceCalculation=t}};function Q(e,t){const i=new Pt(e,t);return ze(i),i}function Ut(e,t,i){let n;function s(o){for(const c of o)switch(c.type){case"splice":r.spliceChildren(c.index,c.count,c.items?.map(l=>e(l))??[]);break;case"move":r.moveChildren(c.from,c.count,c.to);break;case"sort":r.sortChildren(c.from,c.indexes);break}}const r=new ue({onAlive:()=>{n=t.subscribe(s),Z(()=>{r.spliceChildren(0,0,t.map(o=>e(o)))})},onDestroy:()=>{n?.(),Z(()=>{r.spliceChildren(0,t.length,[])})}},[],i??`CollectionRenderNode(${t.__debugName})`);return r}var fe=class{constructor(e,t){this._val=e,this._changeClock=0,this.__processable=!0,this.__refcount=0,this.__debugName=t??"field"}get(){return R(this),this._val}set(e){e!==this._val&&(this._subscribers&&(this._changeClock+=1),this._val=e,this.__refcount>0&&Ce(this))}subscribe(e){return this.retain(),this._subscribers||(this._subscribers=new Map),this._subscribers.set(e,this._changeClock),e(void 0,this._val),()=>{this._subscribers?.has(e)&&(this._subscribers?.delete(e),this.release())}}retain(){M(this)}release(){b(this)}__alive(){de(this)}__dead(){he(this)}__recalculate(){if(f(this.__refcount>0,"cannot flush dead field"),this._subscribers){for(const[e,t]of this._subscribers)t<this._changeClock&&e(void 0,this._val),this._subscribers.set(e,0);this._changeClock=0}return!0}};function Je(e,t){return new fe(e,t)}var Qe=class{constructor(e,t,i,n){this.__refcount=0,this.__debugName=n??"fieldmap",this.keysField=e,this.fieldMap=new Map,this.consumer=t,this.emitter=i}getOrMake(e,t){let i=this.fieldMap.get(e);return i||(i=new fe(t,`${this.__debugName}:${e}`),this.fieldMap.set(e,i),this.__refcount>0&&(M(i),this.consumer&&U(this.consumer,i),this.emitter&&U(i,this.emitter))),i}set(e,t){this.getOrMake(e,void 0).set(t)}delete(e){const t=this.fieldMap.get(e);t&&(t.set(void 0),this.fieldMap.delete(e),this.__refcount>0&&(this.emitter&&K(t,this.emitter),this.consumer&&K(this.consumer,t),b(t)))}keys(){return R(this.keysField),this.fieldMap.keys()}values(){return R(this.keysField),this.fieldMap.values()}entries(){return R(this.keysField),this.fieldMap.entries()}clear(){[...this.fieldMap.keys()].forEach(t=>{this.delete(t)})}__dead(){for(const e of this.fieldMap.values())this.emitter&&K(e,this.emitter),this.consumer&&K(this.consumer,e),b(e);this.emitter&&K(this.keysField,this.emitter),this.consumer&&K(this.consumer,this.keysField),b(this.keysField),this.emitter&&b(this.emitter),this.consumer&&b(this.consumer)}__alive(){this.emitter&&M(this.emitter),this.consumer&&M(this.consumer),M(this.keysField),this.emitter&&U(this.keysField,this.emitter),this.consumer&&U(this.consumer,this.keysField);for(const e of this.fieldMap.values())M(e),this.emitter&&U(e,this.emitter),this.consumer&&U(this.consumer,e)}},Kt=class{__recalculate(){for(const e of this.handler(this.target,this.events))this.transformEmitter.addEvent(e);return this.events.splice(0,this.events.length),!1}__alive(){this.isActive=!0,de(this),M(this.sourceEmitter),qe(this.sourceEmitter,this),this.unsubscribe=this.sourceEmitter.subscribe(e=>{for(const t of e)this.addEvent(t)})}__dead(){this.unsubscribe&&(this.unsubscribe(),Ie(this.sourceEmitter,this),b(this.sourceEmitter)),this.events.splice(0,this.events.length),he(this),this.isActive=!1}constructor(e,t,i,n,s,r){this.target=e,this.handler=n,this.events=[],this.isActive=!1,this.sourceEmitter=t,this.transformEmitter=i,this.appendEvent=s,this.__refcount=0,this.__processable=!0,this.__debugName=`consumer:${r}`}addEvent(e){if(!this.isActive)return;const t=this.events.length===0;this.appendEvent(this.events,e),t&&Ce(this)}addField(e){this.isActive&&(M(e),U(this,e))}removeField(e){this.isActive&&(K(this,e),b(e))}},Ze=class{__recalculate(){for(const e of this.subscribers)e.handler(e.events),e.events=[];return!0}__alive(){this.isActive=!0,de(this)}__dead(){f(this.subscribers.length===0,"released subscription emitter that had subscribers"),he(this),this.isActive=!1}constructor(e,t){this.appendEvent=e,this.subscribers=[],this.isActive=!1,this.__refcount=0,this.__processable=!0,this.__debugName=`emitter:${t}`}addEvent(e){if(!this.isActive)return;let t=!1;for(const i of this.subscribers)i.events.length===0&&(t=!0),this.appendEvent(i.events,e);t&&Ce(this)}subscribe(e){return this.subscribers.push({handler:e,events:[]}),()=>{const t=this.subscribers.findIndex(i=>i.handler===e);t!==-1&&this.subscribers.splice(t,1)}}},et=class{constructor(e,t,i,n,s,r,o,c="trackeddata"){this.target=e,this.methods=i,this.emitter=new Ze(r,c),n&&s?this.consumer=new Kt(e,n,this.emitter,s,o,c):this.consumer=null,this.keys=new Set(Object.keys(e)),this.keysField=new fe(this.keys.size,`${c}:@keys`),this.fieldMap=new Qe(this.keysField,this.consumer,this.emitter,c);const l=a=>{this.emitter.addEvent(a)};this.dataAccessor={get:(a,h)=>{if(a==="__tdHandle")return this;if(a==="__debugName")return c;if(a==="__processable")return!1;if(a==="__refcount"||a==="__alive"||a==="__dead"||a==="__renderNode")return i[a];if(typeof a=="symbol")return Reflect.get(this.target,a,h);if(a in i)return i[a];const d=Reflect.get(this.target,a,h),u=this.fieldMap.getOrMake(a,d);return R(this.revocable.proxy),R(u),d},peekHas:a=>Reflect.has(e,a),has:a=>{if(a==="__refcount"||a==="__alive"||a==="__dead")return a in i;if(a==="__processable"||a in i)return!0;if(typeof a=="symbol")return Reflect.has(this.target,a);const h=Reflect.has(e,a),d=this.fieldMap.getOrMake(a,h);return R(this.revocable.proxy),R(d),h},set:(a,h,d)=>{if(a==="__refcount")return i[a]=h,!0;if(a in i)return!1;if(typeof a=="symbol")return Reflect.set(this.target,a,h,d);const u=Reflect.has(e,a);return this.fieldMap.getOrMake(a,h).set(h),u||(this.keys.add(a),this.keysField.set(this.keys.size)),Reflect.set(e,a,h,this.revocable.proxy)},delete:a=>{if(a==="__refcount"||a==="__alive"||a==="__dead"||a==="__processable"||a in i)return!1;if(typeof a=="symbol")return Reflect.deleteProperty(this.target,a);const h=Reflect.has(e,a),d=Reflect.deleteProperty(e,a);return h&&(this.keys.delete(a),this.keysField.set(this.keys.size),this.fieldMap.delete(a)),d}},this.revocable=Proxy.revocable(e,{get:(a,h,d)=>t.get(this.dataAccessor,l,h,d),has:(a,h)=>t.has(this.dataAccessor,l,h),set:(a,h,d,u)=>t.set(this.dataAccessor,l,h,d,u),deleteProperty:(a,h)=>t.delete(this.dataAccessor,l,h),ownKeys:()=>{const a=this.keys;return this.keysField.get(),[...a]}}),ze(this.revocable.proxy)}};function S(e){return e.__tdHandle}function qt(){return{_type:"collection",splice:Wt,push:Jt,pop:Zt,shift:ti,unshift:ni,sort:hi,reverse:ui,reject:si,moveSlice:ri,mapView:it,filterView:nt,flatMapView:st,subscribe:tt,__refcount:0,__alive:oi,__dead:ai,__debugName:"collection",__renderNode:rt}}function zt(e){return{_type:"view",splice:Xt,push:Yt,pop:Qt,shift:ei,unshift:ii,sort:li,reverse:ci,mapView:it,filterView:nt,flatMapView:st,subscribe:tt,__refcount:0,__alive(){M(e);const t=S(this);f(t,"missing tdHandle"),M(t.fieldMap)},__dead(){const t=S(this);f(t,"missing tdHandle"),b(t.fieldMap),b(e)},__debugName:"collection",__renderNode:rt}}var Gt={get:(e,t,i,n)=>e.get(i,n),has:(e,t,i)=>e.has(i),set:(e,t,i,n,s)=>{if(typeof i=="string"){const r=parseInt(i,10);isNaN(r)||t({type:"splice",index:r,count:1,items:[n]})}return e.set(i,n,s)},delete:(e,t,i)=>e.delete(i)},$t={get:(e,t,i,n)=>e.get(i,n),has:(e,t,i)=>e.has(i),set:(e,t,i,n,s)=>{if(i==="__refcount")return e.set(i,n,s);H("Cannot mutate readonly view")},delete:(e,t,i)=>{H("Cannot mutate readonly view")}};function jt(e,t){return new et(e,Gt,qt(),null,null,oe,oe,t).revocable.proxy}function Xt(e,t,...i){H("Cannot mutate readonly view")}function G(e,t,i,...n){const s=e.target.length,r=Array.prototype.splice.call(e.target,t,i,...n),o=e.target.length;if(s===o)for(let c=t;c<t+n.length;++c)e.fieldMap.set(c.toString(),e.target[c]);else{for(let c=t;c<o;++c)e.fieldMap.set(c.toString(),e.target[c]);for(let c=o;c<s;++c)e.fieldMap.delete(c.toString());e.fieldMap.set("length",o)}return e.emitter.addEvent({type:"splice",index:t,count:i,items:n}),r}function Wt(e,t=0,...i){const n=S(this);return f(n,"missing tdHandle"),G(n,e,t,...i)}function Yt(...e){H("Cannot mutate readonly view")}function Jt(...e){const t=S(this);return f(t,"missing tdHandle"),G(t,t.target.length,0,...e),t.target.length}function Qt(){H("Cannot mutate readonly view")}function Zt(){const e=S(this);return f(e,"missing tdHandle"),G(e,e.target.length-1,1)[0]}function ei(){H("Cannot mutate readonly view")}function ti(){const e=S(this);return f(e,"missing tdHandle"),G(e,0,1)[0]}function ii(...e){H("Cannot mutate readonly view")}function ni(...e){const t=S(this);return f(t,"missing tdHandle"),G(t,0,0,...e),t.target.length}function si(e){const t=S(this);f(t,"missing tdHandle");let i=null,n=t.target.length,s=!1;const r=[];for(let o=0;o<n;++o)if(s=e(t.target[o]),s&&i===null&&(i=o),!s&&i!==null){const c=o-i;r.push(...G(t,i,c)),n-=c,o-=c,i=null}if(i!==null){const o=n-i;r.push(...G(t,i,o))}return r}function ri(e,t,i){const n=S(this);f(n,"moveSlice missing tdHandle");const s=n.target.splice(e,t);n.target.splice(i,0,...s),n.emitter.addEvent({type:"move",from:e,count:t,to:i})}function tt(e){const t=S(this);f(t,"subscribe missing tdHandle"),M(this),M(t.emitter);const i=t.emitter.subscribe(n=>{e(n)});return()=>{i(),b(t.emitter),b(this)}}function oi(){const e=S(this);f(e,"missing tdHandle"),M(e.fieldMap)}function ai(){const e=S(this);f(e,"missing tdHandle"),b(e.fieldMap)}function li(e){H("Cannot mutate readonly view")}function ci(){H("Cannot mutate readonly view")}function di(e,t){if(e===void 0&&t===void 0)return 0;if(e===void 0)return 1;if(t===void 0)return-1;const i=""+e,n=""+t;return i<n?-1:i>n?1:0}function hi(e=di){const t=S(this);f(t,"collectionSort missing tdHandle");let i=null;t.emitter&&(i=t.target.map((n,s)=>s).sort((n,s)=>e(t.target[n],t.target[s]))),t.target.sort(e),i&&t.emitter.addEvent({type:"sort",from:0,indexes:i});for(let n=0;n<t.target.length;++n)t.fieldMap.set(n.toString(),t.target[n]);return this}function ui(){const e=S(this);if(f(e,"collectionReverse missing tdHandle"),e.target.reverse(),e.emitter){const t=[];for(let i=e.target.length-1;i>=0;--i)t.push(i);e.emitter.addEvent({type:"sort",from:0,indexes:t})}for(let t=0;t<e.target.length;++t)e.fieldMap.set(t.toString(),e.target[t]);return this}function it(e,t){return ke(this,i=>[e(i)],t)}function nt(e,t){return ke(this,i=>e(i)?[i]:[],t)}function st(e,t){return ke(this,e,t)}function ke(e,t,i){const n=S(e);f(n,"missing tdHandle");const s=[],r=[];Z(()=>{for(const c of e){const l=t(c);s.push(l.length),r.push(...l)}});const o=new et(r,$t,zt(e),n.emitter,function*(c,l){for(const a of l){const h=r.length;switch(yield*mt(s,t,r,a),a.type){case"splice":{const d=r.length;if(h===d)for(let u=a.index;u<a.index+a.count;++u)o.fieldMap.set(u.toString(),r[u]);else{for(let u=a.index;u<d;++u)o.fieldMap.set(u.toString(),r[u]);for(let u=d;u<h;++u)o.fieldMap.delete(u.toString());o.fieldMap.set("length",d)}break}case"move":{const d=Math.min(a.from,a.to),u=Math.max(a.from+a.count,a.to+a.count);for(let y=d;y<u;++y)o.fieldMap.set(y.toString(),r[y]);break}case"sort":for(let d=a.from;d<a.from+a.indexes.length;++d)o.fieldMap.set(d.toString(),r[d]);break}}},oe,oe,i??"derived");return o.revocable.proxy}function rt(e){return Ut(e,this,this.__debugName)}function fi(e,t){e.push(t)}function ot(e){return e.__handle}function Be(e,t){const i=new fe(Object.keys(e).length),n=new Ze(fi,t??"model"),s=new Qe(i,null,n,t),r={target:e,emitter:n,fieldMap:s},o={...e};return Object.keys(e).forEach(c=>{Object.defineProperty(o,c,{get:()=>s.getOrMake(c,e[c]).get(),set:l=>{s.getOrMake(c,l).set(l),n.addEvent({type:"set",prop:c,value:l})}})}),Object.defineProperty(o,"__handle",{get:()=>r}),o}Be.subscribe=function(t,i,n){const s=ot(t);f(s,"missing model __handle"),M(s.emitter),M(s.fieldMap);const r=s.emitter.subscribe(o=>{i(o)});return()=>{r(),b(s.emitter),b(s.fieldMap)}};Be.field=function(t,i){const n=ot(t);return f(n,"missing model __handle"),n.fieldMap.getOrMake(i,n.target[i])};function mi(e,t){const i=e.childNodes.length,n=[];for(let o=0;o<e.childNodes.length;++o)n.push(He(e.childNodes[o]));n.push(t);const s=Xe(e,te(n),null);s.retain();let r;if(s.attach({nodeEmitter:o=>{f(!1,"Unexpected event emitted by Portal",o)},errorEmitter:o=>{r=o,ee("Unhandled mount error",o)},xmlNamespace:(e instanceof Element?e.namespaceURI:e.host.namespaceURI)??ce}),r)throw s.release(),r;return s.onMount(),le(),()=>{const o=Array.from(e.childNodes).slice(0,i);s.onUnmount(),le(),e.replaceChildren(...o),s.detach(),s.release()}}var L=Ye;const pi=({key:e,isPressed:t,hue:i,saturation:n},{onMount:s})=>L("div",{"cssprop:hue":i,"cssprop:saturation":n,class:Q(()=>we(t)?"KeyboardKey KeyboardKey--pressed":"KeyboardKey")},e),at=["1234567890".split(""),"qwertyuiop".split(""),"asdfghjkl;".split(""),"zxcvbnm,./".split("")],yi=at.length,vi=10,B={Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0",Minus:"-",Equal:"=",KeyA:"a",KeyB:"b",KeyC:"c",KeyD:"d",KeyE:"e",KeyF:"f",KeyG:"g",KeyH:"h",KeyI:"i",KeyJ:"j",KeyK:"k",KeyL:"l",KeyM:"m",KeyN:"n",KeyO:"o",KeyP:"p",KeyQ:"q",KeyR:"r",KeyS:"s",KeyT:"t",KeyU:"u",KeyV:"v",KeyW:"w",KeyX:"x",KeyY:"y",KeyZ:"z",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/"},v=function(e,t){return e*Math.pow(Math.pow(2,1/12),t)},gi={1:v(880,0),2:v(880,2),3:v(880,4),4:v(880,5),5:v(880,7),6:v(880,9),7:v(880,11),8:v(880,12),9:v(880,14),0:v(880,16),"-":v(880,17),"=":v(880,19),q:v(440,0),w:v(440,2),e:v(440,4),r:v(440,5),t:v(440,7),y:v(440,9),u:v(440,11),i:v(440,12),o:v(440,14),p:v(440,16),a:v(220,0),s:v(220,2),d:v(220,4),f:v(220,5),g:v(220,7),h:v(220,9),j:v(220,11),k:v(220,12),l:v(220,14),";":v(220,16),z:v(110,0),x:v(110,2),c:v(110,4),v:v(110,5),b:v(110,7),n:v(110,9),m:v(110,11),",":v(110,12),".":v(110,14),"/":v(110,16)},Ei=(e,{onMount:t})=>{const i=new AudioContext({latencyHint:"interactive"}),n=i.createGain();n.gain.value=.3,n.connect(i.destination);const s=Object.fromEntries(Object.entries(gi).map(([h,d])=>{const u=i.createGain();u.gain.value=0,u.connect(n);const y=i.createOscillator();return y.frequency.value=d,y.connect(u),y.start(i.currentTime),[h,{oscillator:y,oscillatorGain:u}]})),r=Be({1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,0:!1,"-":!1,"=":!1,a:!1,b:!1,c:!1,d:!1,e:!1,f:!1,g:!1,h:!1,i:!1,j:!1,k:!1,l:!1,m:!1,n:!1,o:!1,p:!1,q:!1,r:!1,s:!1,t:!1,u:!1,v:!1,w:!1,x:!1,y:!1,z:!1,";":!1,"'":!1,",":!1,".":!1,"/":!1}),o=jt([]);let c=null;const l=Je(null);t(()=>{document.body.addEventListener("keydown",h=>{const d=performance.now(),u=i.currentTime;if(!h.repeat){if(o.push(d),o.length>10&&o.shift(),h.code in B&&B[h.code]&&(s[B[h.code]]&&s[B[h.code]].oscillatorGain.gain.linearRampToValueAtTime(1/42,u+.1),r[B[h.code]]=!0),c!==null){const y=d-c;if(l.get()===null)l.set(y);else{const x=l.get(),I=.1,p=I*y+(1-I)*x;l.set(p)}}c=d}}),document.body.addEventListener("keyup",h=>{const d=i.currentTime;h.code in B&&B[h.code]&&(s[B[h.code]]&&s[B[h.code]].oscillatorGain.gain.linearRampToValueAtTime(0,d+.5),r[B[h.code]]=!1)})});const a=[];for(let h=0;h<9;++h)a.push(L("li",null,Q(()=>h+1<o.length?`${(o[h+1]-o[h]).toFixed(2)}ms`:"...")));return L("div",null,L("div",null,at.map((h,d)=>L("div",null,h.map((u,y)=>L(pi,{hue:`${360*y/vi}deg`,saturation:`${100*(.25+.5*d/yi)}%`,key:u,isPressed:Q(()=>r[u])}))))),L("p",null),L("ul",null,a),L("p",null,"Exp weighted average:"," ",Q(()=>{const h=l.get();return h===null?"N/A":`${h.toFixed(2)}ms`})))},Fe=Je(!1),Ve=document.getElementById("app");Ve?mi(Ve,L(L.Fragment,null,L("h1",null,"Cold fingers"),Q(()=>Fe.get()?L(Ei,null):L("button",{"on:click":()=>Fe.set(!0)},"Click to start")))):alert("RUH ROH, no #app element found");
